# module.hsp


## PCのスポットライトが死亡後も下1/3だけ残る問題
17 名無しさん＠お腹いっぱい。 sage 2011/03/18(金) 15:24:57.79 ID:+1MGsrf8
PCのスポットライトが死亡後も下1/3だけ残る問題。

場所はcell_draw命令内。
スポットライトの描画は下側1/3と上側2/3に分けて行われるんだが、
前者に「PCが存在しているとき」という条件が付けられていない。

## F11のキャラダンプ機能でHspError 23が発生する問題
145 名前：異形の森の名も無き使者[sage] 投稿日：2011/05/14(土) 14:23:32 ID:Xqv0Dngg
安定版でF11のキャラダンプ機能を使用すると、下記のようなエラーが出て強制終了し、生成されません。
対処法わかる方が居ましたら教えてください。
HspError 23 WinError 0 Ver 1160 Mode 0
efId 0 efP 0 Area 15/1
ci 0#200 ti 0#200 cc 0#0 tc 0#0 rc 101#77
3. Dump:Init ct:0
2. Dump:1 ct:0
1. Dump:1-2 ct:0
0. Dump:1-3 ct:0

module.hsp 2294行目
 m=""+strmid(s,0,len)
↓
 m=""+strmid(m,0,len)
## *参考リンク
[[HSP3のFAQ:エラーメッセージの意味と対処法が分からない>http://quasiquote.org/hspwiki/HSP3%E3%81%AEFAQ%3a%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E6%84%8F%E5%91%B3%E3%81%A8%E5%AF%BE%E5%87%A6%E6%B3%95%E3%81%8C%E5%88%86%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84#H-zupint]]


## サイズが小さいマップでボール系魔法を唱えると落ちることがある問題
119 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：12/02/05 21:53:09 ID:n1JrLP9C
ボール系魔法のアニメ描画ルーチンが、マップの大きさをチェックしてない。
縦横どちらかの大きさが画面より小さいマップ(特に盗賊の隠れ家)では、
アニメの描画座標がマップの範囲外に出てエラーになる可能性がある。

120 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：12/02/10 00:49:36 ID:Ga6UgjJn
fov_los関数がマップの大きさをチェックしてなくて、範囲外の座標を与えられるとエラーになる。
~>>119のバグもこれが原因で引き起こされてる。

## マップフィート情報がオーバーフローする問題
cell_featset命令の第6パラメータに215以上の値(例: 地雷敷設者のユニット番号)を指定すると、
マップフィート情報の値がオーバーフローする。
chipm配列変数を参照する箇所でError 7が発生する原因。

144 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：12/08/15 18:46:19 ID:EElK3lDJ
overhaulの高レベルネフィアでHspError7で落ちしてしまうので
逆コンのやり方調べて原因を探ったが
公式版でもおきそうなのでここに書いてみる

cell_featsetの5番目の引数がダンジョンの階層で変動するようだが
feat@m80(2)へ代入するときにlimitで制限かけないとオーバーフローする可能性がある

## 乗馬されているペットが他のキャラを押しのけたと表示される問題
cell_swap命令内
最初のreturnをreturn false
最後のreturnをreturn true
としておいて

"を押しのけた。"の行の最初にif stat=true :を追加

逆コンなら
false→0
true→1
と読み替えてくれればいい

## 来客用の椅子やマイチェアが壁で埋まっていても来客イベントでそこに座ってしまう問題
module.hsp cell_swap命令
通行可能かをチェックしていない
リリィ売り飛ばし・ギルドの番人移動でも同様のことが起こるはず

