# chat.hsp


## チュートリアルでPC側の受け答えがおかしい問題
77 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：11/04/26 07:03:48 ID:USteEQji
割と細かい不具合(動作に影響なし)

チュートリアル中、宝箱の開け方の部分でPC側の受け答えがおかしい

逆コンソース 175390行目
strbyeをlang("わかった", "Okay.")とかに変更

## ラーネイレが死んでいる状態でロミアスをわが家から追い出そうとしたときのイベントが起きない問題

chat.hsp 629行目
  if chatVal=2{
    tc=findChara(33)
    if tc=false{ ;←ここの判定がおかしい
      tc=findChara(34)
      chatMore lang("ラーネイレ…？ どこにいったんだ？ まさか貴様！","You...you scum!"),strBye:hostileAction pc,tc
      goto *chat_end
      }

## クエスト報酬素材槌の色等が一致していない問題
84 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：11/05/24 09:43:30 ID:4cyP8egr
クエスト報酬素材槌の色等が一致していない問題

逆コンitemcreate -1, 630で検索してすぐ下の

inv(24, ci) = ??
となっている部分を

fixmaterial = ??
gosub *label_0265
に変更(3箇所)

## アリーナで指定される敵の名前が食い違うことがある問題
乱数が違うので銀眼などのランダムネームは名前が食い違う
依頼などと同様に
cnName(rc)→cnOrgName(cId(rc))
とすれば種族名だけが表示される
ただし『』や≪≫は付かない
逆コンなら
cdatan(0, rc)→refchara(cdata(27, rc), 2, 1)

引数がユニット番号でなくキャラIDであることに注意

## 時を止めている間にメイドに話しかけると待機人数以上に来客イベントが追加できる問題
evAdd evVisitor
↓
if gTimeStopTime=0:evAdd evVisitor
で応急処置

逆コンでも
evadd 25のところに
if gdata(801) = 0 {
の条件を追加しておけばよい

リリィを殺すイベントでもリリィをサンドバッグに吊るして時を止めることで同様のことができるが
特に進行に問題は出ないので放置


## ブラックマーケットの商品入荷数がおかしい問題
534 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：2011/04/23(土) 23:02:33.98 ID:K4vO9SMw
結局noa猫に聞いてきたよー
・ブラックマーケットの商品数に上限が無いのは願いのアイテム数がおかしいのと同様。他と同じで80上限が正しい
~*shop_restock(*label_2265)のif p>80:p=80みたいなのを一個後の処理と入れ替え

## 後に入荷したアイテムが先に入荷した同じアイテムの個数を上書きする問題
558 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：2011/04/24(日) 05:22:00.73 ID:RjXe18TX
NPCお店の入荷時の処理についてだけども
item_create -1, dbId
した後で
iNum(ci) = rnd(rtVal) + 1
で入荷個数の調整してるよな？
これ
noStack = true
してないんで同じアイテム入荷した場合、スタック後に個数書き換えに
なってないか？
これが意図通りの動作なのかは分からないけどまずい気がする

560 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：2011/04/24(日) 08:24:30.86 ID:jzS1U4/o
~>>558
してみたら交易品が爆発したぞ

561 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：2011/04/24(日) 09:08:45.00 ID:RjXe18TX
~>>560
おぉう、交易店はさらにその後２倍、場合によってはさらに２倍もしくは
半分、場合によってはさらに半分みたいな処理がiNum(ci)に対して入ってるね
パン屋さんあたりは入荷数増えて嬉しくなるんだが…どうしたもんだか

564 名前：名無しさん＠お腹いっぱい。[sage] 投稿日：2011/04/24(日) 09:46:03.55 ID:tvBbSNWZ
~>>561
っつかnostack入れないとスタックすらされずに個数上書きされてね？
どちらにしろさらに調整しないとバランス大きく変化するから個人的には放置でもいい気がする

## 生化学者の野望クエストに誤字がある問題

chat.hsp 1591行目
ボールのLV以下の相手には効かないから
↓
ボールのLV以下の相手にしか効かないから

